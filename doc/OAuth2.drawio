<mxfile host="Electron" modified="2023-07-05T17:54:05.145Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.4.0 Chrome/112.0.5615.204 Electron/24.5.1 Safari/537.36" etag="AtjB99aCWmhea0WjRoBy" version="21.4.0" type="device" pages="6">
  <diagram id="aqbcsqOdKXl0R0V0Bvpi" name="OAuth2 overview">
    <mxGraphModel dx="1036" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="AxgvVVQgyzHv1RvVFmev-1" value="&lt;div&gt;Resources:&lt;br&gt;&lt;br&gt;JSON Web Token (JWT) - https://www.rfc-editor.org/rfc/rfc7519&lt;/div&gt;&lt;div&gt;JSON Web Token Best Current Practices - https://www.rfc-editor.org/rfc/rfc8725&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The OAuth 2.0 Authorization Framework - https://www.rfc-editor.org/rfc/rfc6749&lt;/div&gt;&lt;div&gt;OAuth 2.0 Authorization Server Metadata - https://www.rfc-editor.org/rfc/rfc8414&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;Proof Key for Code Exchange by OAuth Public Clients - https://www.rfc-editor.org/rfc/rfc7636&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;OAuth 2.0 Device Authorization Grant - https://www.rfc-editor.org/rfc/rfc8628&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Resource Indicators for OAuth 2.0 - https://www.rfc-editor.org/rfc/rfc8707&lt;/div&gt;&lt;div&gt;OAuth 2.0 Token Introspection - https://www.rfc-editor.org/rfc/rfc7662&lt;br&gt;&lt;/div&gt;&lt;div&gt;OAuth 2.0 Token Exchange - https://www.rfc-editor.org/rfc/rfc8693&lt;/div&gt;&lt;div&gt;OAuth 2.0 Token Revocation - https://www.rfc-editor.org/info/rfc7009&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The OAuth 2.1 Authorization Framework - https://datatracker.ietf.org/doc/draft-ietf-oauth-v2-1/&lt;/div&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="190" width="790" height="260" as="geometry" />
        </mxCell>
        <mxCell id="iBpAJNjlJGQ-oz6BmGX8-1" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;1. OAuth roles&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;2. OAuth grant types&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;3. Token validation&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;4. Token refreshing, exchanging, revocation&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;5. Strategies for token handling&lt;br&gt;&lt;/div&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;" parent="1" vertex="1">
          <mxGeometry x="30" y="40" width="380" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="OAuth2 roles" id="Zt19pPAAxFtv1y2cKK0m">
    <mxGraphModel dx="1036" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-0" />
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-1" parent="AwP5pMVrFSAQA9QWJmXB-0" />
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-2" value="Resource Owner" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="117.5" y="210" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-3" value="&lt;font color=&quot;#ff3333&quot;&gt;Authorization Server&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="369.5" y="390" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-4" value="&lt;font color=&quot;#ff3333&quot;&gt;Client&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="369.5" y="214" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-5" value="API&lt;br&gt;&lt;br&gt;&lt;font color=&quot;#ff3333&quot;&gt;Resource Server&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="644.5" y="214" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-6" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="AwP5pMVrFSAQA9QWJmXB-1" source="AwP5pMVrFSAQA9QWJmXB-2" target="AwP5pMVrFSAQA9QWJmXB-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="397.5" y="174" as="sourcePoint" />
            <mxPoint x="447.5" y="124" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-7" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="AwP5pMVrFSAQA9QWJmXB-1" source="AwP5pMVrFSAQA9QWJmXB-4" target="AwP5pMVrFSAQA9QWJmXB-5" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="544.5" y="244" as="sourcePoint" />
            <mxPoint x="594.5" y="194" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AwP5pMVrFSAQA9QWJmXB-8" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="AwP5pMVrFSAQA9QWJmXB-1" source="AwP5pMVrFSAQA9QWJmXB-4" target="AwP5pMVrFSAQA9QWJmXB-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="544.5" y="324" as="sourcePoint" />
            <mxPoint x="594.5" y="274" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Q1Vp_jiUAT_NeTQJOmnj-0" value="Azure AD&lt;br&gt;Keycloak&lt;br&gt;Spring Authorization Server" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="332" y="470" width="195" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Q1Vp_jiUAT_NeTQJOmnj-2" value="Mobile phone app (Public)&lt;br&gt;Web app&amp;nbsp;(Public)&lt;br&gt;Desktop app&amp;nbsp;(Public)&lt;br&gt;Server app&amp;nbsp;(Confidential)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="331" y="124" width="195" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Q1Vp_jiUAT_NeTQJOmnj-3" value="User" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="50" y="304" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q1Vp_jiUAT_NeTQJOmnj-5" value="Any external/internal backend application, for example:&lt;br&gt;&lt;br&gt;Google Photos&lt;br&gt;Orders Microservice" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="614.5" y="294" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HsL3VLqoOqaa9Rj4IUsG-0" value="OAuth2 roles" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="40" y="30" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TdWNXYSMpb8IDOCsBsDI-0" value="JWT token" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="40" y="600" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TdWNXYSMpb8IDOCsBsDI-1" value="sub - Subject. Whom the token belongs to (Resource Owner or Resource Server).&lt;br&gt;aud - Audience. Which Resource Server is allowed to use token.&lt;br&gt;azp - Authorized party. The party to which the token was issued (Resource Owner or Resource Server).&lt;br&gt;iss - Issuer. Which&amp;nbsp;Authorization Server issued and signed the token.&lt;br&gt;iat - Issued at. When the token was issued.&lt;br&gt;exp - Expiration time. When the token expires.&lt;br&gt;scp - Scope. A list of allowed permissions that the Resource Server can perform on the Subject of the token." style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;size=23;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="37.5" y="660" width="582.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="TdWNXYSMpb8IDOCsBsDI-2" value="&lt;div&gt;{&lt;br&gt;&amp;nbsp; &quot;sub&quot;: &quot;3bca71ee-3ce5-4b0d-91fd-261f796e8016&quot;,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;aud&quot;: [ &quot;order-service&quot;, &quot;user-service&quot; ],&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;azp&quot;: &quot;management-service&quot;,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;iss&quot;: &quot;authorization-server&quot;,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;iat&quot;: 1686584863,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;exp&quot;: 1686590045,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &quot;scp&quot;: &quot;order-service/submit user-service/read.all&quot;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;size=22;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="37.5" y="860" width="312.5" height="140" as="geometry" />
        </mxCell>
        <mxCell id="TdWNXYSMpb8IDOCsBsDI-3" value="Example of token content" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="AwP5pMVrFSAQA9QWJmXB-1" vertex="1">
          <mxGeometry x="37.5" y="800" width="195" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="OAuth2 grant types" id="d6BOeeEDrsHv-NYRMRdH">
    <mxGraphModel dx="1036" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="bmZXnPftIuqgBOj6CYiI-0" />
        <mxCell id="bmZXnPftIuqgBOj6CYiI-1" parent="bmZXnPftIuqgBOj6CYiI-0" />
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-38" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#d3d3d3;strokeWidth=2;labelBackgroundColor=none;labelBorderColor=none;fontSize=14;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="390" y="2700" width="490" height="160" as="geometry" />
        </mxCell>
        <mxCell id="ofl-19eUHNOB5huSkhPp-0" value="Authorization Code (Confidential)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="60.25" y="110" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ofl-19eUHNOB5huSkhPp-1" value="Resource owner" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="60.25" y="190" width="100" height="529" as="geometry" />
        </mxCell>
        <mxCell id="ofl-19eUHNOB5huSkhPp-2" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="430.25" y="190" width="100" height="530" as="geometry" />
        </mxCell>
        <mxCell id="ofl-19eUHNOB5huSkhPp-3" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="870.25" y="190" width="100" height="530" as="geometry" />
        </mxCell>
        <mxCell id="ofl-19eUHNOB5huSkhPp-5" value="1. Click login" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="ofl-19eUHNOB5huSkhPp-2" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="109.75" y="257" as="sourcePoint" />
            <mxPoint x="339.75" y="257" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nxFmmeCS1Yx7uIpTlj11-0" value="2. Request authorization code&amp;nbsp;" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="ofl-19eUHNOB5huSkhPp-3" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="480.25" y="281" as="sourcePoint" />
            <mxPoint x="569.75" y="281" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nxFmmeCS1Yx7uIpTlj11-2" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;GET https://.../authorize?response_type=code&amp;amp;scope={SCOPES}&amp;amp;redirect_uri={REDIRECT_URL}&amp;amp;client_id=...&amp;amp;state={CSRF}&lt;/font&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="490.25" y="300" width="420" height="49" as="geometry" />
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--0" value="Client credentials (Confidential)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80" y="1889" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--1" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80" y="1969" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--2" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="550" y="1969" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--3" value="1. Request a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="uEerB83g1fCTvpU5qrE--2" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="129.5" y="2036" as="sourcePoint" />
            <mxPoint x="359.5" y="2036" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--4" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=client_credentials&lt;br&gt;&amp;amp;scope={SCOPES}&lt;br&gt;&amp;amp;client_id=...&lt;br&gt;&amp;amp;client_secret=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="140" y="2049" width="420" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uEerB83g1fCTvpU5qrE--5" value="2. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="599.5" y="2208" as="sourcePoint" />
            <mxPoint x="129.75925925925935" y="2208" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-0" value="Resource owner password (Confidential)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80" y="1436" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-1" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="379" y="1520" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-2" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="834" y="1520" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-3" value="2. Request a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="428.5" y="1610" as="sourcePoint" />
            <mxPoint x="884" y="1610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-4" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=password&lt;br&gt;&amp;amp;scope={SCOPES}&lt;br&gt;&amp;amp;username=...&lt;br&gt;&amp;amp;password=...&lt;br&gt;&amp;amp;client_id=...&lt;br&gt;&amp;amp;client_secret=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="439" y="1623" width="420" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JGzCTPrvS8rFfiY7JzhH-5" value="3. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" source="JGzCTPrvS8rFfiY7JzhH-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="898.5" y="1795" as="sourcePoint" />
            <mxPoint x="428.75925925925935" y="1795" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-0" value="3. Redirect to login page" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="0.5032" y="1" relative="1" as="geometry">
            <mxPoint x="918.75" y="369" as="sourcePoint" />
            <mxPoint x="109.14393939393938" y="369" as="targetPoint" />
            <Array as="points">
              <mxPoint x="289.25" y="369" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-1" value="4. Login and consent" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="ofl-19eUHNOB5huSkhPp-3" edge="1">
          <mxGeometry x="-0.5793" width="80" relative="1" as="geometry">
            <mxPoint x="109.91666666666663" y="402" as="sourcePoint" />
            <mxPoint x="849.7500000000002" y="402" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-3" value="5. Return an aurhotization code" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" source="ofl-19eUHNOB5huSkhPp-3" edge="1">
          <mxGeometry x="0.5546" relative="1" as="geometry">
            <mxPoint x="849.7500000000002" y="441" as="sourcePoint" />
            <mxPoint x="109.91666666666663" y="441" as="targetPoint" />
            <Array as="points">
              <mxPoint x="300.25" y="441" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-4" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;Redirect to {REDIRECT_URL}?code=[CODE]&amp;amp;state={CSRF}&lt;/font&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="120.25" y="450" width="790" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-5" value="6. Exchange Authorization Code for Access Token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="ofl-19eUHNOB5huSkhPp-3" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="480.25" y="522" as="sourcePoint" />
            <mxPoint x="850.25" y="522" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-7" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=authorization_code&lt;br&gt;&amp;amp;scope={SCOPES}&lt;br&gt;&amp;amp;code=[CODE]&lt;br&gt;&amp;amp;redirect_uri={REDIRECT_URL}&lt;br&gt;&amp;amp;client_id=...&lt;br&gt;&amp;amp;client_secret=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="490.25" y="530" width="420" height="140" as="geometry" />
        </mxCell>
        <mxCell id="RI128JUF6ZQ6aTOXwx7Q-9" value="7. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="0.5546" relative="1" as="geometry">
            <mxPoint x="919.7499999999998" y="690.0000000000001" as="sourcePoint" />
            <mxPoint x="110.125" y="690.0000000000001" as="targetPoint" />
            <Array as="points">
              <mxPoint x="310.58" y="690" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-11" value="PKCE-enhanced Authorization code (Public)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="60.25" y="779" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-12" value="Resource owner" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="60.25" y="859" width="100" height="529" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-13" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="430.25" y="859" width="100" height="530" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-14" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1090" y="882" width="100" height="530" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-15" value="1. Click login" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" target="RC2Ia2Zla0OmjFyjj-zo-13" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="109.75" y="926" as="sourcePoint" />
            <mxPoint x="339.75" y="926" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-16" value="2. Request authorization code&amp;nbsp;" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="480.25" y="950" as="sourcePoint" />
            <mxPoint x="1139.75" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-17" value="GET https://.../authorize?response_type=code&amp;amp;scope={SCOPES}&amp;amp;redirect_uri={REDIRECT_URL}&amp;amp;client_id=...&amp;amp;code_challenge=...&amp;amp;code_challenge_method=S256&amp;amp;state={CSRF}" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="490.25" y="969" width="630" height="50" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-18" value="3. Redirect to login page" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="0.5326" y="2" relative="1" as="geometry">
            <mxPoint x="1139.75" y="1038" as="sourcePoint" />
            <mxPoint x="109.14393939393926" y="1038" as="targetPoint" />
            <Array as="points">
              <mxPoint x="289.25" y="1038" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-19" value="4. Login and consent" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="-0.5793" width="80" relative="1" as="geometry">
            <mxPoint x="109.91666666666674" y="1071" as="sourcePoint" />
            <mxPoint x="1139.75" y="1071" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-20" value="5. Return an aurhotization code" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="0.5546" relative="1" as="geometry">
            <mxPoint x="1139.75" y="1110" as="sourcePoint" />
            <mxPoint x="109.91666666666674" y="1110" as="targetPoint" />
            <Array as="points">
              <mxPoint x="300.25" y="1110" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-21" value="Redirect to {REDIRECT_URL}?code=[CODE]&amp;amp;state={CSRF}" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="120.25" y="1119" width="1010" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-22" value="6. Exchange Authorization Code for Access Token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="480.25" y="1191" as="sourcePoint" />
            <mxPoint x="1139.75" y="1191" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-23" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=urn:ietf:params:oauth:grant-type:device_code&lt;br&gt;&amp;amp;device_code=...&lt;br&gt;&amp;amp;client_id=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="410" y="2740" width="450" height="100" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-24" value="7. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="0.5546" relative="1" as="geometry">
            <mxPoint x="1139.75" y="1367" as="sourcePoint" />
            <mxPoint x="110.125" y="1367" as="targetPoint" />
            <Array as="points">
              <mxPoint x="310.5799999999999" y="1367" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-29" value="Device code (Public)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80.25" y="2309" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-30" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="350" y="2389" width="100" height="531" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-31" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="820" y="2389" width="100" height="531" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-32" value="2. Request a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="399.5" y="2482" as="sourcePoint" />
            <mxPoint x="869.5" y="2482" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-33" value="curl --request POST &#39;https://.../devicecode&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;scope=...&lt;br&gt;&amp;amp;client_id=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="410" y="2495" width="420" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-34" value="3. Return a device + user codes and verification url" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="869.5" y="2619" as="sourcePoint" />
            <mxPoint x="399.75925925925935" y="2619" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-35" value="6. Exchange Authorization Code for Access Token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;entryX=0.5;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="399.78571428571433" y="2727.1" as="sourcePoint" />
            <mxPoint x="870" y="2727.1" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RC2Ia2Zla0OmjFyjj-zo-41" value="7. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry x="-0.0216" relative="1" as="geometry">
            <mxPoint x="870" y="2905" as="sourcePoint" />
            <mxPoint x="399.3888888888889" y="2905" as="targetPoint" />
            <Array as="points">
              <mxPoint x="870" y="2905" />
              <mxPoint x="640" y="2905" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jQuVjD72LNOMqIHTet-c-0" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=authorization_code&lt;br&gt;&amp;amp;scope={SCOPES}&lt;br&gt;&amp;amp;code=[CODE]&lt;br&gt;&amp;amp;redirect_uri={REDIRECT_URL}&lt;br&gt;&amp;amp;code_verifier=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="490.25" y="1209" width="640" height="140" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-0" value="User" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1030" y="244" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-1" value="3rd party Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1162" y="380" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-2" value="Frontend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1162" y="249" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-3" value="Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1380" y="250" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-4" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-0" target="-d-gdLHgYQddvcBm1LSy-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1320" y="188" as="sourcePoint" />
            <mxPoint x="1370" y="138" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-5" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-2" target="-d-gdLHgYQddvcBm1LSy-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1467" y="258" as="sourcePoint" />
            <mxPoint x="1517" y="208" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-6" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-2" target="-d-gdLHgYQddvcBm1LSy-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1467" y="338" as="sourcePoint" />
            <mxPoint x="1517" y="288" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-7" value="3rd party&lt;br&gt;Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1570" y="250" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-8" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-3" target="-d-gdLHgYQddvcBm1LSy-7" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1690" y="294" as="sourcePoint" />
            <mxPoint x="1845" y="294" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-9" value="User" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1240" y="920" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-10" value="3rd party Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1372" y="1040" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-11" value="Frontend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1372" y="924" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-13" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-9" target="-d-gdLHgYQddvcBm1LSy-11" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1320" y="493" as="sourcePoint" />
            <mxPoint x="1370" y="443" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-14" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-11" target="-d-gdLHgYQddvcBm1LSy-16" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1467" y="563" as="sourcePoint" />
            <mxPoint x="1567" y="568" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-15" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="-d-gdLHgYQddvcBm1LSy-11" target="-d-gdLHgYQddvcBm1LSy-10" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1467" y="643" as="sourcePoint" />
            <mxPoint x="1517" y="593" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-d-gdLHgYQddvcBm1LSy-16" value="3rd party&lt;br&gt;Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1570" y="925" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="56Hhalpf8j93eqOraMS5-0" value="3rd party Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="800" y="2150" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="56Hhalpf8j93eqOraMS5-1" value="Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="800" y="2004" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="56Hhalpf8j93eqOraMS5-2" value="3rd party&lt;br&gt;Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1030" y="2004" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="56Hhalpf8j93eqOraMS5-5" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="56Hhalpf8j93eqOraMS5-1" target="56Hhalpf8j93eqOraMS5-0" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="740" y="2194" as="sourcePoint" />
            <mxPoint x="790" y="2144" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="56Hhalpf8j93eqOraMS5-6" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="56Hhalpf8j93eqOraMS5-1" target="56Hhalpf8j93eqOraMS5-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="2164" as="sourcePoint" />
            <mxPoint x="810" y="2114" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AyiFv0F08FZ23TL1NHjl-0" value="OAuth2 grant types" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="60.25" y="30" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4r36uc1_eR8ns0bWrc1-2" value="Frontend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1300" y="1574" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4r36uc1_eR8ns0bWrc1-3" value="3rd party&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1525" y="1574" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4r36uc1_eR8ns0bWrc1-4" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="l4r36uc1_eR8ns0bWrc1-2" target="l4r36uc1_eR8ns0bWrc1-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="975" y="1730" as="sourcePoint" />
            <mxPoint x="1025" y="1680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4r36uc1_eR8ns0bWrc1-7" value="3rd party Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1300" y="1724" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4r36uc1_eR8ns0bWrc1-8" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="l4r36uc1_eR8ns0bWrc1-2" target="l4r36uc1_eR8ns0bWrc1-7" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1335" y="2019" as="sourcePoint" />
            <mxPoint x="1467" y="2019" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-0" value="User" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1145" y="1569" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-1" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="sUqFaT2tJhmYZrT0JF_C-0" target="l4r36uc1_eR8ns0bWrc1-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="903" y="1138" as="sourcePoint" />
            <mxPoint x="955" y="1604" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-8" value="Frontend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1232.5" y="2435" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-9" value="3rd party&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;Backend" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1460" y="2435" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-10" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="sUqFaT2tJhmYZrT0JF_C-8" target="sUqFaT2tJhmYZrT0JF_C-9" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1252.5" y="2595" as="sourcePoint" />
            <mxPoint x="1302.5" y="2545" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-11" value="3rd party Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1232.5" y="2590" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-12" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="sUqFaT2tJhmYZrT0JF_C-8" target="sUqFaT2tJhmYZrT0JF_C-11" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1612.5" y="2884" as="sourcePoint" />
            <mxPoint x="1744.5" y="2884" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-13" value="User" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="1077.5" y="2430" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sUqFaT2tJhmYZrT0JF_C-14" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="bmZXnPftIuqgBOj6CYiI-1" source="sUqFaT2tJhmYZrT0JF_C-13" target="sUqFaT2tJhmYZrT0JF_C-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1180.5" y="2003" as="sourcePoint" />
            <mxPoint x="1232.5" y="2469" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-0" value="Resource owner" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80" y="2389" width="100" height="529" as="geometry" />
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-4" value="Poll till the Resource Owner activates the user code" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;labelBorderColor=none;fontSize=12;fontColor=#000000;fillColor=none;size=11;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="250" y="2740" width="130" height="80" as="geometry" />
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-5" value="4. Return the user code and verification url" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="399.5" y="2650.5" as="sourcePoint" />
            <mxPoint x="129.8939393939395" y="2650.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-6" value="" style="endArrow=classic;html=1;rounded=0;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="129.590909090909" y="2679.5000000000005" as="sourcePoint" />
            <mxPoint x="869.5" y="2679.5000000000005" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-7" value="5. Open the verification url and enter the user code" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="PULuemBKtQw07jeLBVRr-6" vertex="1" connectable="0">
          <mxGeometry x="-0.1359" y="1" relative="1" as="geometry">
            <mxPoint x="115" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-10" value="" style="endArrow=classic;html=1;rounded=0;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="129.32352941176464" y="2461.4999999999995" as="sourcePoint" />
            <mxPoint x="399.5" y="2461.4999999999995" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-11" value="1. Click login" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="PULuemBKtQw07jeLBVRr-10" vertex="1" connectable="0">
          <mxGeometry x="-0.1263" y="2" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-12" value="Resource owner" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="bmZXnPftIuqgBOj6CYiI-1" vertex="1">
          <mxGeometry x="80.25" y="1520" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-13" value="" style="endArrow=classic;html=1;rounded=0;" parent="bmZXnPftIuqgBOj6CYiI-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="129.57352941176464" y="1591" as="sourcePoint" />
            <mxPoint x="430" y="1591" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PULuemBKtQw07jeLBVRr-14" value="1. Enter login and password" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="PULuemBKtQw07jeLBVRr-13" vertex="1" connectable="0">
          <mxGeometry x="-0.1263" y="2" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Token validation" id="vCWLvGVii-XZwr0wAJl_">
    <mxGraphModel dx="1886" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-0" />
        <mxCell id="gAAR4ApAEUXGEyejJDVu-1" parent="gAAR4ApAEUXGEyejJDVu-0" />
        <mxCell id="gAAR4ApAEUXGEyejJDVu-7" value="Resource server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-525" y="200" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-30" value="Self validation" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="110" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-31" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="190" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-32" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-265" y="200" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-33" value="2. Request a public key to verify token&lt;br&gt;(E.g.: once per 1 hour)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="gAAR4ApAEUXGEyejJDVu-32" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-210.33333333333348" y="154.99999999999955" as="sourcePoint" />
            <mxPoint x="50" y="155" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-34" value="1. Access any resource using token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="gAAR4ApAEUXGEyejJDVu-1" target="gAAR4ApAEUXGEyejJDVu-7" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-770.7499999999998" y="275" as="sourcePoint" />
            <mxPoint x="-285" y="275" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-35" value="curl --request GET &#39;https://...&#39; \&lt;br&gt;--header &#39;Authorization:&amp;nbsp; Bearer ...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-755" y="290" width="270" height="50" as="geometry" />
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-36" value="3. Verify token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;edgeStyle=orthogonalEdgeStyle;" parent="gAAR4ApAEUXGEyejJDVu-1" edge="1">
          <mxGeometry x="0.4992" width="80" relative="1" as="geometry">
            <mxPoint x="-474.999090909091" y="391" as="sourcePoint" />
            <mxPoint x="-475.5526315789475" y="421.00000000000045" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-385" y="391" />
              <mxPoint x="-385" y="421" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gAAR4ApAEUXGEyejJDVu-37" value="4. Return a response" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="gAAR4ApAEUXGEyejJDVu-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-475.4999999999998" y="451" as="sourcePoint" />
            <mxPoint x="-770.5526315789475" y="451" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-0" value="Resource server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-525" y="620" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-1" value="Introspection" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="530" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-2" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="610" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-3" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-265" y="620" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-4" value="2. Introspect a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="W0j8j9U07C5lsX7zh9DD-3" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-210.33333333333348" y="154.99999999999955" as="sourcePoint" />
            <mxPoint x="50" y="155" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-5" value="1. Access any resource using token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="gAAR4ApAEUXGEyejJDVu-1" target="W0j8j9U07C5lsX7zh9DD-0" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-770.7499999999998" y="695" as="sourcePoint" />
            <mxPoint x="-285" y="695" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-6" value="curl --request GET &#39;https://...&#39; \&lt;br&gt;--header &#39;Authorization:&amp;nbsp; Bearer ...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-755" y="710" width="270" height="50" as="geometry" />
        </mxCell>
        <mxCell id="W0j8j9U07C5lsX7zh9DD-8" value="3. Return a response" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="gAAR4ApAEUXGEyejJDVu-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-475.4999999999998" y="871" as="sourcePoint" />
            <mxPoint x="-770.5526315789475" y="871" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="o7f4pCWMuNWEhSzC5yqN-0" value="Token validation" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="30" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OCn-SxS_zyhkSV9RE3Mw-0" value="&lt;div&gt;The Resource Server must verify the token signature using Authorization Server public key and validate claims such as &quot;exp&quot;, &quot;iss&quot;, &quot;aud&quot;, &quot;scp&quot;.&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;size=15;" parent="gAAR4ApAEUXGEyejJDVu-1" vertex="1">
          <mxGeometry x="-820" y="940" width="450" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="pK8MJChjdVlLWAJtTxhV" name="Refresh/Exchange token">
    <mxGraphModel dx="1036" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="6uMTGIUAi1BHeq-WyorD-1" value="Exchange token" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="500" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6uMTGIUAi1BHeq-WyorD-2" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="30" y="580" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="6uMTGIUAi1BHeq-WyorD-3" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="560" y="580" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="6uMTGIUAi1BHeq-WyorD-4" value="1. Request a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" target="6uMTGIUAi1BHeq-WyorD-3" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="79.5" y="647" as="sourcePoint" />
            <mxPoint x="309.5" y="647" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6uMTGIUAi1BHeq-WyorD-5" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&lt;br&gt;&amp;amp;requested_token_type=urn:ietf:params:oauth:token-type:access_token&lt;br&gt;&amp;amp;scope=...&lt;br&gt;&amp;amp;audience=...&lt;br&gt;&amp;amp;subject_token=...&lt;br&gt;&amp;amp;client_id=...&lt;br&gt;&amp;amp;client_secret=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="90" y="660" width="510" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6uMTGIUAi1BHeq-WyorD-6" value="2. Return a token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="609.5" y="855" as="sourcePoint" />
            <mxPoint x="79.75925925925935" y="855" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gIHSWmWH5Xkw-Rwl4acQ-1" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;Keycloak:&lt;/div&gt;&lt;div&gt;https://www.keycloak.org/docs/latest/securing_apps/#_token-exchange&lt;br&gt;https://github.com/keycloak/keycloak/issues/20702&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Azure AD:&lt;br&gt;Possible to exchange using refresh token or on behalf flow.&lt;/div&gt;&lt;div&gt;https://learn.microsoft.com/en-us/azure/active-directory/develop/refresh-tokens&lt;/div&gt;&lt;div&gt;https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;" parent="1" vertex="1">
          <mxGeometry x="30" y="910" width="650" height="150" as="geometry" />
        </mxCell>
        <mxCell id="Cx4gaTMIVBJwENu2SJz3-1" value="Request a token for specific audiences (Resource indicators)" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="1120" width="450" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cx4gaTMIVBJwENu2SJz3-2" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;Keycloak:&lt;/div&gt;&lt;div&gt;https://github.com/keycloak/keycloak/issues/13614&lt;/div&gt;&lt;div&gt;Possible by creating custom scopes and mappers.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Azure AD:&lt;/div&gt;&lt;div&gt;https://learn.microsoft.com/en-us/azure/active-directory/develop/scopes-oidc#the-default-scope&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;" parent="1" vertex="1">
          <mxGeometry x="30" y="1190" width="650" height="150" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-1" value="User" style="shape=actor;whiteSpace=wrap;html=1;verticalAlign=bottom;labelPosition=center;verticalLabelPosition=middle;align=center;" parent="1" vertex="1">
          <mxGeometry x="800" y="620" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-2" value="Authorization Server" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1052" y="800" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-3" value="Frontend" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1052" y="624" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-4" value="Backend A" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1327" y="624" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-5" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.9;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="Jn5lTKmtlev-e-ZJCqQg-1" target="Jn5lTKmtlev-e-ZJCqQg-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1080" y="584" as="sourcePoint" />
            <mxPoint x="1130" y="534" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-6" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jn5lTKmtlev-e-ZJCqQg-3" target="Jn5lTKmtlev-e-ZJCqQg-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1227" y="654" as="sourcePoint" />
            <mxPoint x="1277" y="604" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-7" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Jn5lTKmtlev-e-ZJCqQg-3" target="Jn5lTKmtlev-e-ZJCqQg-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1227" y="734" as="sourcePoint" />
            <mxPoint x="1277" y="684" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-8" value="Backend B" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1585" y="624" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Jn5lTKmtlev-e-ZJCqQg-9" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jn5lTKmtlev-e-ZJCqQg-4" target="Jn5lTKmtlev-e-ZJCqQg-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1450" y="690" as="sourcePoint" />
            <mxPoint x="1605" y="690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-2" value="User" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="790" y="935" width="100" height="380" as="geometry" />
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-3" value="Frontend" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1070" y="935" width="100" height="380" as="geometry" />
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-4" value="1.&amp;nbsp; Opens a page" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" target="SQFH8brAWtrJWFLwLU0T-3" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="839.5000000000002" y="1002" as="sourcePoint" />
            <mxPoint x="1069.5" y="1002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-6" value="4. Return token B" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1339.590909090909" y="1118" as="sourcePoint" />
            <mxPoint x="1609.4999999999995" y="1118" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-7" value="Backend A" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1560" y="935" width="100" height="380" as="geometry" />
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-8" value="Backend B" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1806" y="935" width="100" height="380" as="geometry" />
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-9" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1290" y="935" width="100" height="380" as="geometry" />
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-10" value="2. Calls backend A with token A" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" target="SQFH8brAWtrJWFLwLU0T-7" edge="1">
          <mxGeometry x="-0.3875" width="80" relative="1" as="geometry">
            <mxPoint x="1120.0000000000002" y="1025" as="sourcePoint" />
            <mxPoint x="1399.9999999999995" y="1025" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-11" value="3. Exchanges token A to token B for Backend B" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry x="0.02" width="80" relative="1" as="geometry">
            <mxPoint x="1609.4999999999995" y="1079" as="sourcePoint" />
            <mxPoint x="1339.590909090909" y="1079" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-13" value="5. Calls backend B with token B" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry x="0.02" width="80" relative="1" as="geometry">
            <mxPoint x="1609.6304347826085" y="1156" as="sourcePoint" />
            <mxPoint x="1855.5000000000005" y="1156" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-14" value="6. Return data" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" source="SQFH8brAWtrJWFLwLU0T-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1899.4999999999995" y="1197" as="sourcePoint" />
            <mxPoint x="1609.590909090909" y="1197" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-15" value="7. Return data" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1609.4999999999995" y="1229" as="sourcePoint" />
            <mxPoint x="1119.590909090909" y="1229" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SQFH8brAWtrJWFLwLU0T-16" value="7.Display data" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1119.4999999999995" y="1280" as="sourcePoint" />
            <mxPoint x="839.5909090909092" y="1280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-7" value="Refresh token" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="40" y="30" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-8" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="40" y="110" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-9" value="Authorization Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;labelBackgroundColor=none;labelBorderColor=none;fontColor=#000000;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="510" y="110" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-10" value="1. Request a token" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;fontColor=#000000;" parent="1" target="kdoDarEVsOSbWcCeflnG-9" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="89.5" y="177.00000000000023" as="sourcePoint" />
            <mxPoint x="319.5" y="177" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-11" value="curl --request POST &#39;https://.../token&#39; \&lt;br&gt;--header &#39;Content-Type: application/x-www-form-urlencoded&#39; \&lt;br&gt;--data-raw &#39;grant_type=refresh_token&lt;br&gt;&amp;amp;client_id=...&lt;br&gt;&amp;amp;client_secret=...&lt;br&gt;&amp;amp;refresh_token=...&#39;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="100" y="190" width="420" height="110" as="geometry" />
        </mxCell>
        <mxCell id="kdoDarEVsOSbWcCeflnG-12" value="2. Return a new token" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;fontSize=11;fontColor=#000000;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="559.5" y="350.0000000000002" as="sourcePoint" />
            <mxPoint x="89.75925925925935" y="350.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UFdUNZ1gy67U7yCG-ryE-1" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;Keycloak:&lt;/div&gt;&lt;div&gt;https://www.keycloak.org/docs/latest/securing_apps/#_token_revocation_endpoint&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Azure AD:&lt;/div&gt;&lt;div&gt;https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/users-revoke-access#access-tokens-and-refresh-tokens&lt;/div&gt;&lt;/div&gt;" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;" parent="1" vertex="1">
          <mxGeometry x="30" y="1490" width="860" height="150" as="geometry" />
        </mxCell>
        <mxCell id="UFdUNZ1gy67U7yCG-ryE-2" value="Revoke token" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="1420" width="290" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="NInfXLVa6-nAp6QMs_YO" name="Examples and strategies">
    <mxGraphModel dx="1036" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="P88QEk7z5GCVTWRBsrV--1" value="1. One token per group of services" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="60" y="100" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="P88QEk7z5GCVTWRBsrV--2" value="2. One token for multiple services" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="60" y="410" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="P88QEk7z5GCVTWRBsrV--4" value="3. One token per each service" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="60" y="690" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-1" value="Gateway&lt;br&gt;&lt;br&gt;&amp;lt;audience=G&amp;gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="220" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-2" value="Service A" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="150" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-3" value="Service B" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="300" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-4" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="dIhhYXn3akd9fJJnQgbT-1" target="dIhhYXn3akd9fJJnQgbT-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="320" as="sourcePoint" />
            <mxPoint x="500" y="270" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="185" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-5" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="dIhhYXn3akd9fJJnQgbT-1" target="dIhhYXn3akd9fJJnQgbT-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="230" as="sourcePoint" />
            <mxPoint x="530" y="335" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="335" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="dIhhYXn3akd9fJJnQgbT-7" value="Token G" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="ktoQ3Sb-axn2w8lIFoMK-21" target="dIhhYXn3akd9fJJnQgbT-1" edge="1">
          <mxGeometry x="-0.2" y="15" width="50" height="50" relative="1" as="geometry">
            <mxPoint x="180" y="255.0000000000001" as="sourcePoint" />
            <mxPoint x="310" y="200" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ktoQ3Sb-axn2w8lIFoMK-21" value="Client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="220" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-2" value="Service A&lt;br&gt;&lt;br&gt;&amp;lt;audience=A&amp;gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="460" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-3" value="Service B&lt;br&gt;&lt;br&gt;&amp;lt;audience=B&amp;gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="610" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-4" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="AN0O8u8X1MZj96hfC7jT-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="570" as="sourcePoint" />
            <mxPoint x="500" y="580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="495" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-5" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="AN0O8u8X1MZj96hfC7jT-7" target="AN0O8u8X1MZj96hfC7jT-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="339.9999999999998" y="600" as="sourcePoint" />
            <mxPoint x="530" y="645" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="565" />
              <mxPoint x="340" y="645" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-6" value="Token with audience A and B" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="AN0O8u8X1MZj96hfC7jT-5" vertex="1" connectable="0">
          <mxGeometry x="-0.6555" relative="1" as="geometry">
            <mxPoint x="15" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-7" value="Client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="530" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AN0O8u8X1MZj96hfC7jT-8" value="Strategies for token handling" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;labelBackgroundColor=none;labelBorderColor=none;align=left;" parent="1" vertex="1">
          <mxGeometry x="60" y="30" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-1" value="Service A&lt;br&gt;&lt;br&gt;&amp;lt;audience=A&amp;gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="740" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-2" value="Service B&lt;br&gt;&lt;br&gt;&amp;lt;audience=B&amp;gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="890" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-3" value="Token A" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="pITFfw02tL1HFV7ERdMv-1" edge="1">
          <mxGeometry x="0.3488" y="15" width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="850" as="sourcePoint" />
            <mxPoint x="500" y="860" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="775" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-4" value="Token B" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="pITFfw02tL1HFV7ERdMv-5" target="pITFfw02tL1HFV7ERdMv-2" edge="1">
          <mxGeometry x="0.6316" y="15" width="50" height="50" relative="1" as="geometry">
            <mxPoint x="339.9999999999998" y="880" as="sourcePoint" />
            <mxPoint x="530" y="925" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="845" />
              <mxPoint x="340" y="925" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pITFfw02tL1HFV7ERdMv-5" value="Client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="810" width="120" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
